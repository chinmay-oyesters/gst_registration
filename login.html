<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign in & Sign up Form</title>
    <!-- custom css -->
    <link rel="stylesheet" href="css/auth.css" />
    <!-- Font-icon css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
    <!-- NOTE: START: -->
    <!-- loader -->
    <div class="overlay"></div>
    <div class="spanner">
        <div class="loader"></div>
    </div>
    <!-- END: -->
    <div class="container">
        <div class="forms-container">
            <div class="signin-signup">
                <form action="#" class="sign-in-form">
                    <h2 class="title">Sign in</h2>
                    <div class="input-field">
                        <i class="fa fa-user"></i>
                        <input type="email" placeholder="Email" id="sign_in_email" />
                    </div>
                    <div class="input-field">
                        <i class="fa fa-lock"></i>
                        <input type="password" placeholder="Password" id="sign_in_password" />
                    </div>
                    <input type="button" value="Login" onclick="handleSignIn()" class="btn solid" />
                    <p>or</p>
                    <div style="margin-top: 10px;">
                        <a href="forgot-password.html" style="color: rgb(168, 165, 165);text-decoration: none;">Forgot
                            Password ?</a>
                    </div>
                </form>
                <form action="#" class="sign-up-form">
                    <h2 class="title">Sign up</h2>
                    <div style="width: 100%;display: flex;justify-content: space-between;">
                        <div class="input-field">
                            <i class="fa fa-user"></i>
                            <input type="text" placeholder="Entity Name" id="sign_up_entity_name" />
                        </div>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <div class="input-field">
                            <i class="fa fa-envelope"></i>
                            <input type="email" placeholder="Entity Email" id="sign_up_entity_email" />
                        </div>
                    </div>
                    <div style="width: 100%;display: flex;justify-content: space-between;">
                        <div class="input-field">
                            <i class="fa fa-id-card-o" aria-hidden="true"></i>
                            <input type="text" placeholder="Entity PAN" onkeyup="this.value = this.value.toUpperCase();"
                                id="sign_up_entity_pan" />
                        </div>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <div class="input-field">
                            <i class="fa fa-phone" aria-hidden="true"></i>
                            <input type="text" placeholder="Entity Mobile Number" maxlength="10"
                                oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="sign_up_entity_mobile" />
                        </div>
                    </div>
                    <div style="width: 100%;display: flex;justify-content: space-between;">
                        <div class="input-field">
                            <i class="fa fa-user"></i>
                            <input type="text" placeholder="Name" id="sign_up_name" />
                        </div>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <div class="input-field">
                            <i class="fa fa-envelope"></i>
                            <input type="email" placeholder="Email" id="sign_up_email" />
                        </div>
                    </div>
                    <div style="width: 100%;display: flex;justify-content: space-between;">
                        <div class="input-field">
                            <i class="fa fa-phone"></i>
                            <input type="text" placeholder="Mobile" maxlength="10"
                                oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="sign_up_mobile" />
                        </div>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <div class="input-field">
                            <i class="fa fa-file-text" aria-hidden="true"></i>
                            <select name="" id="reg_form" style="border:none;background: none;outline: none;">
                            </select>
                        </div>
                    </div>
                    <div style="width: 100%;display: flex;justify-content: space-between;">
                        <div class="input-field">
                            <i class="fa fa-lock" aria-hidden="true"></i>
                            <input type="password" placeholder="Password" id="sign_up_password" />
                        </div>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <div class="input-field">
                            <i class="fa fa-lock" aria-hidden="true"></i>
                            <input type="password" placeholder="Confirm Password" id="sign_up_confirm_password" />
                        </div>
                    </div>
                    <input type="button" class="btn" onclick="handleSignUp()" value="Sign up" />
                </form>
            </div>
        </div>

        <div class="panels-container">
            <div class="panel left-panel">
                <div class="content">
                    <h3>New here ?</h3>
                    <p>
                        Lorem ipsum, dolor sit amet consectetur adipisicing elit. Debitis,
                        ex ratione. Aliquid!
                    </p>
                    <button class="btn transparent" id="sign-up-btn">
                        Sign up
                    </button>
                </div>
                <img src="images/signin-img.svg" class="image" alt="" />
            </div>
            <div class="panel right-panel">
                <div class="content">
                    <h3>One of us ?</h3>
                    <p>
                        Lorem ipsum dolor sit amet consectetur adipisicing elit. Nostrum
                        laboriosam ad deleniti.
                    </p>
                    <button class="btn transparent" id="sign-in-btn">
                        Sign in
                    </button>
                </div>
                <img src="images/signup-img.svg" class="image" alt="" />
            </div>
        </div>
        <div id="auth_logo">
            <h2 onclick="location.href='index.html'" style="cursor:pointer;">GST - ®️</h2>
        </div>
    </div>
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/globalFunction.js"></script>
    <script src="js/plugins/pace.min.js"></script>
    <script type="text/javascript" src="js/plugins/bootstrap-notify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-notify/0.2.0/js/bootstrap-notify.min.js"
        integrity="sha512-vCgNjt5lPWUyLz/tC5GbiUanXtLX1tlPXVFaX5KAQrUHjwPcCwwPOLn34YBFqws7a7+62h7FRvQ1T0i/yFqANA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-notify/0.2.0/js/bootstrap-notify.js"
        integrity="sha512-thJ99QHPSIGxvufiC1cqtmE5PgfRjYfa8PXpuhjAwiLij9VhATR+lApJU5Y4t7kQepIVq1n9QkAqVx5YIt2UFw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        let isLoggedIn = localStorage.getItem("isLoggedIn");
        if (isLoggedIn === "true") {
            location.href = "dashboard.html";
        }
        const sign_in_btn = document.querySelector("#sign-in-btn");
        const sign_up_btn = document.querySelector("#sign-up-btn");
        const container = document.querySelector(".container");
        let reg_form_value = sessionStorage.getItem('reg_form')
        if (reg_form_value) {
            container.classList.add("sign-up-mode");
            document.getElementById("auth_logo").classList.add("sign-up-mode");
            document.getElementById('reg_form').value = reg_form_value
            sessionStorage.removeItem('reg_form')
        }
        sign_up_btn.addEventListener("click", () => {
            container.classList.add("sign-up-mode");
            document.getElementById("auth_logo").classList.add("sign-up-mode");
        });

        sign_in_btn.addEventListener("click", () => {
            container.classList.remove("sign-up-mode");
            document.getElementById("auth_logo").classList.remove("sign-up-mode");
        });
        window.onload = function () {
            getList()
        }
        function getList() {
            startLoader()
            axiosInstance.get('register_for').then((response) => {
                endLoader()
                if (response.status === 200) {
                    let dataSet = response?.data?.form_dropdown
                    console.log(dataSet)
                    let cards_container = document.getElementById('reg_form')
                    cards_container.innerHTML = '<option value=""><span style="color:gray;">-- Select Form --</span></option>';
                    for (let i = 0; i < dataSet.length; i++) {
                        const element = dataSet[i];
                        cards_container.innerHTML = cards_container.innerHTML +
                            `<option value='${element?.form_id}'>${element?.form_name}</option>`
                    }
                } else {
                    if (response?.data?.is_logged_out) {
                        localStorage.setItem("isLoggedIn", "false");
                        location.href = "index.html";
                    } else {
                        $.notify({
                            title: "",
                            message: response.data?.msg,
                            icon: 'fa fa-times'
                        }, {
                            type: "danger",
                        });
                    }
                }
                console.log(response)
            }, (error) => {
                console.log('error', error);
                endLoader()
                $.notify({
                    title: "",
                    message: `Something went wrong! Please try again.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger"
                });
            })
        }
        function handleSignUp() {
            startLoader()
            let entity_name = document.getElementById('sign_up_entity_name')
            let entity_email = document.getElementById('sign_up_entity_email')
            let entity_pan = document.getElementById('sign_up_entity_pan')
            let entity_mobile = document.getElementById('sign_up_entity_mobile')
            let name = document.getElementById('sign_up_name')
            let email = document.getElementById('sign_up_email')
            let mobile = document.getElementById('sign_up_mobile')
            let reg_form = document.getElementById('reg_form')
            let password = document.getElementById('sign_up_password')
            let confirm_password = document.getElementById('sign_up_confirm_password')
            if (entity_name.value == "" || entity_email.value == "" || entity_pan.value == "" || entity_mobile.value == "" || name.value == "" || email.value == "" || mobile.value == "" || password.value == "" || confirm_password.value == "") {
                $.notify({
                    title: "",
                    message: `Please enter all the fields.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger",
                });
                endLoader();
                return
            }
            if (!validateEmail(entity_email.value)) {
                $.notify({
                    title: "",
                    message: `Please enter a valid entity email.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger",
                });
                endLoader();
                return
            }
            if (!validateEmail(email.value)) {
                $.notify({
                    title: "",
                    message: `Please enter a valid email.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger",
                });
                endLoader();
                return
            }
            if (!validatePAN(entity_pan.value)) {
                $.notify({
                    title: "",
                    message: `Please enter a valid PAN number.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger",
                });
                endLoader();
                return
            }
            if (entity_mobile.value?.length != 10) {
                $.notify({
                    title: "",
                    message: `Please enter a valid entity mobile number.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger",
                });
                endLoader();
                return
            }
            if (mobile.value?.length != 10) {
                $.notify({
                    title: "",
                    message: `Please enter a valid mobile number.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger",
                });
                endLoader();
                return
            }
            if (password.value != confirm_password.value) {
                $.notify({
                    title: "",
                    message: `Password didn't match.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger",
                });
                endLoader();
                return
            }
            if (reg_form.value == "") {
                $.notify({
                    title: "",
                    message: `Please select registration from.`,
                    icon: 'fa fa-times'

                }, {
                    type: "danger",

                });
                endLoader();
                return
            }
            axiosInstance.post('user_signup', {
                "user_password": password.value,
                "user_fullname": name.value,
                "user_email": email.value,
                "user_phonenumber": mobile.value,
                "entity_pan": entity_pan.value,
                "entity_fullname": entity_name.value,
                "entity_email": entity_email.value,
                "entity_phonenumber": entity_mobile.value,
                "register_for": reg_form?.value
            }).then((response) => {
                console.log(response)
                endLoader()
                if (response.status === 200) {
                    $.notify({
                        title: "",
                        message: response.data?.msg,
                        icon: 'fa fa-check'
                    }, {
                        type: "success",
                    });
                    setTimeout(() => {
                        container.classList.remove("sign-up-mode");
                        document.getElementById("auth_logo").classList.remove("sign-up-mode");
                    }, 1000);
                } else {
                    $.notify({
                        title: "",
                        message: response.data?.msg,
                        icon: 'fa fa-times'
                    }, {
                        type: "danger",
                    });
                }
            }, (error) => {
                endLoader()
                console.log('error', error);
                $.notify({
                    title: "",
                    message: `Something went wrong! Please try again.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger"
                });
            })
        }
        function handleSignIn() {
            startLoader()
            let email = document.getElementById('sign_in_email')
            let password = document.getElementById('sign_in_password')
            if (email.value == "" || password.value == '') {
                $.notify({
                    title: "",
                    message: `Please enter all the fields.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger",
                });
                endLoader();
                return
            }
            if (!validateEmail(email.value)) {
                $.notify({
                    title: "",
                    message: `Please enter a valid email.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger",
                });
                endLoader();
                return
            }
            axiosInstance.post('user_signin', {
                "user_email": email.value,
                "user_password": password.value
            }).then((response) => {
                console.log(response)
                endLoader()
                if (response.status === 200) {
                    $.notify({
                        title: "",
                        message: response.data?.msg,
                        icon: 'fa fa-check'
                    }, {
                        type: "success",
                    });
                    localStorage.setItem('isLoggedIn', 'true')
                    localStorage.setItem('user_name', response?.data?.user_profile.user_name)
                    localStorage.setItem('user_image', response?.data?.user_profile.user_image)
                    location.href = "dashboard.html";
                } else {
                    $.notify({
                        title: "",
                        message: response.data?.msg,
                        icon: 'fa fa-times'
                    }, {
                        type: "danger",
                    });
                }
            }, (error) => {
                endLoader()
                console.log('error', error);
                $.notify({
                    title: "",
                    message: `Something went wrong! Please try again.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger"
                });
            })
        }
    </script>
</body>

</html>